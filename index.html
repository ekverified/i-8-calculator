function calculate() {
    const button = document.getElementById('calcButton');
    if (isCalculating || !document.getElementById('amount').value || !document.getElementById('dueDate').value || !document.getElementById('checkDate').value) return;

    isCalculating = true;
    button.classList.add('loading');
    button.disabled = true;

    setTimeout(() => {
        const type = document.getElementById('type').value;
        const amount = parseFloat(document.getElementById('amount').value) || 0;
        const dueDateInput = document.getElementById('dueDate').value;
        const checkDateInput = document.getElementById('checkDate').value;
        const dueDate = new Date(dueDateInput + 'T23:59:59+03:00'); // End of due date in EAT
        const checkDate = new Date(checkDateInput + 'T00:00:00+03:00'); // Start of check date in EAT
        const resultDiv = document.getElementById('result');

        if (!amount || isNaN(dueDate.getTime()) || isNaN(checkDate.getTime())) {
            resultDiv.innerHTML = "Please enter valid amount, due date, and check date.";
            resetButton(button);
            return;
        }

        // Calculate days delayed starting from 10th as day 1 after due time
        const timeDiff = checkDate - dueDate;
        let totalDays = Math.floor(timeDiff / (1000 * 60 * 60 * 24)); // Total days from due date end
        let daysDelayed = totalDays >= 0 ? (totalDays > 0 ? totalDays + 1 : 1) : 0; // Start 10th as 1 after due time, 11th as 2, etc.
        console.log('Debug - Due Date:', dueDate.toISOString());
        console.log('Debug - Check Date:', checkDate.toISOString());
        console.log('Debug - Time Diff (ms):', timeDiff);
        console.log('Debug - Total Days:', totalDays);
        console.log('Debug - Days Delayed:', daysDelayed); // Final delay value

        let penalty = 0;
        let interest = 0;
        let totalOwed = amount;

        if (type === 'contribution') {
            const penaltyStartDay = 1; // 10th as day 1 after due time
            if (daysDelayed < penaltyStartDay) {
                penalty = 0;
            } else if (daysDelayed <= 7) { // 7 days total (10thâ€“16th)
                penalty = amount * 0.30;
            } else {
                penalty = (amount * 0.30) + (amount * 0.01 * (daysDelayed - 7)); // 1% daily after 7 days
            }
            totalOwed += penalty;
        } else if (type === 'loan') {
            // Loan calculation disabled for now
            resultDiv.innerHTML = "Loan calculations are on hold.";
            resetButton(button);
            return;
        }

        resultDiv.innerHTML = `
            Days Delayed: ${daysDelayed} days<br>
            ${type === 'loan' ? `Interest: ${interest.toFixed(2)}<br>` : ''}
            Penalty: ${typeof penalty === 'number' ? penalty.toFixed(2) : penalty}<br>
            Total Amount Owed: ${typeof totalOwed === 'number' ? totalOwed.toFixed(2) : totalOwed}
        `;

        resetButton(button);
    }, 1000); // Simulate loading delay
}